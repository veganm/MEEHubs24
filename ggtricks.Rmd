---
title: "gg_tricks"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.


# Getting started
This workshop assumes that you:
* Have R and Rstudio installed (this code was written in 4.3.1 "Beagle Scouts")
* Have a working directory set up for R
* Understand the basics of how R creates and handles objects
* Know the basic parts of a call to *ggplot()*, including how to change aesthetics and geometries


Before we begin, we'll need to install and load the packages we'll be working with from CRAN:
```{r}
pacman::p_load(tidyverse, pokemon, cowplot, ggpubr, gridExtra, ggsci)
```

If you attended the prior workshops, you've already been introduced to Tidyverse and the pokemon data set. We'll also be working with some packages that add new functionality to the ggverse:
* *cowplot* is an add-on to *ggplot* with features that help with creating publication-quality figures, including new themes and functions for assembly of compound multi-panel figures. 
* *gridExtra* allows for more complex plot gridding
* *ggpubr* allows users to annotate plots, including overlay of statistical comparisons directly onto plots, and provides some user-friendly tools for manipulating ggplot formatting
* *ggsci* has a variety of *ggplot2* color palettes inspired by scientific journals, data visualization libraries, movies, and TV shows

## Working with cowplot: themes and plot_grid
This package includes some new theme options to explore:
```{r}
ggplot(pokemon, aes(attack, defense, color=type_1)) +  # data + aesthetics (x, y, point color) 
  geom_point() +
  theme_minimal_vgrid()
#  theme_minimal_hgrid()
#  theme_minimal_grid(12)
#  theme_cowplot(12) # classic cowplot theme
```

Most of the functionality here is for creation of multipanel plots.
```{r}
# Save each ggplot as an object
p1 <- ggplot(pokemon, aes(attack, defense, color=type_1)) +  # data + aesthetics (x, y, point color) 
  geom_point() +
  theme_classic()
p2 <- ggplot(pokemon, aes(height, weight, color=type_1)) +  # data + aesthetics (x, y, point color) 
  geom_point() +
  theme_classic()

plot_grid(p1, p2,
#          labels="AUTO",  # labels panels as "A", "B" etc
          labels="auto",   # labels panels as "a", "b" etc
          label_size = 12)
```


The grid components can be basically any plot object. 
```{r}
p3 <- ggplot(pokemon, aes(attack, defense, color=as.factor(generation_id))) +  # data + aesthetics (x, y, point color) 
  geom_point() +
  geom_smooth() +  # Produces a smoothed line showing data trends
  theme_classic()+
  facet_wrap(~generation_id) +
  labs(color="Generation")

plot_grid(p1, p3)
```


It may be wise to re-orient and/or re-size sub-plots:
```{r}
plot_grid(p1, p3, 
          nrow=1, # orient plots in a single row
          rel_widths = c(1.5,2), # change relative heights,
#          ncol=1, # orient plots in a single column
#          rel_heights = c(1,2), # change relative heights,
          labels = "AUTO"
          )
```

It is a little difficult to see what's happening in plot A. Let's rework it
```{r}
p1

p4 <- ggplot(pokemon, aes(attack, defense, color=type_1)) +  # data + aesthetics (x, y, point color)
  geom_point() +
  theme_classic() + 
  facet_wrap(~type_1)
p4

```

What else should we add or change to this plot?
How about modifying the labels / sizing?

How would you change the attack vs. defense plot for the different generations
(depending on what question you were asking)


**EXERCISE: You try it!** Create a new ggplot object and grid together two or more plots.
```{r}

```



## Data manipulations with dplyr
Sometimes after plotting, may realize that you want to manipulate the data some more to make different plots.
Let's say you want to look for a correlation between typing systems within a pokemon.
However, as an experienced pokeologist, you know that not all pokemon are dual typed.

```{r}
glimpse(pokemon) # taking a look at the data

sum(is.na(pokemon$type_2))
```

To deal with this, you may will need to remove non-dual-typed pokÃ©mon.
While we're at it, let's exclude some columns we don't care about.
```{r}
pokemon %>% select(-url_icon, -url_image) %>%
  na.exclude(type_2)
```

```{r}
pokemon %>% select(-url_icon, -url_image) %>%
  na.exclude(type_2) %>% ggplot(aes(x = type_1, y = type_2, fill = frequency())) + geom_tile()
  
```




## Publication-quality plots with ggpubr



# The Wider ggverse: devtools


# ggsci



# Resources
https://github.com/schochastics/Rokemon
https://cran.r-project.org/web/packages/pokemon/index.html
https://thatdatatho.com/r-resources-beginner-advanced/
https://thatdatatho.com/7-tidyverse-tricks-for-getting-your-data-into-the-right-shape/
https://thatdatatho.com/grammar-of-graphics-ggplot2/
https://thatdatatho.com/grammar-of-graphics-ggplot-tutorial-part2/
https://cran.r-project.org/web/packages/cowplot/vignettes/introduction.html

